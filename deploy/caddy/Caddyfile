{
    email {$LETSENCRYPT_EMAIL}
}

{$DOMAIN} {
    encode zstd gzip
    # Página estática no root
    handle_path / {
        root * /srv
        file_server browse false
    }
    @api path /api* /health
    handle @api {
        reverse_proxy api:5000
    }

    @waha path /waha*
    handle @waha {
        # Para proteger com Basic Auth, descomente o bloco abaixo e defina WAHA_USER e WAHA_PASSWORD_HASH no .env
        # basicauth {
        #     {$WAHA_USER} {$WAHA_PASSWORD_HASH}
        # }
        reverse_proxy waha:3000
    }

    @n8n path /n8n*
    handle @n8n {
        # Para proteger com Basic Auth, descomente o bloco abaixo e defina N8N_USER e N8N_PASSWORD_HASH no .env
        # basicauth {
        #     {$N8N_USER} {$N8N_PASSWORD_HASH}
        # }
        reverse_proxy n8n:5678
    }

    # fallback: se nada casar, serve estático (index.html)
    handle {
        root * /srv
        file_server browse false
    }
}

# Optional: redirect HTTP to HTTPS if Caddy receives plain HTTP on other hosts
http://{$DOMAIN} {
    redir https://{$DOMAIN}{uri} 308
}
